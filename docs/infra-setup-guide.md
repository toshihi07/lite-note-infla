# LiteNote ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰æ‰‹é †æ›¸

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€Terraform ã‚’ç”¨ã„ã¦ AWS ä¸Šã« LiteNote ã®ã‚¤ãƒ³ãƒ•ãƒ©ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®æ‰‹é †ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã™ã€‚  
å¯¾è±¡ç’°å¢ƒï¼š`dev`

---

## ğŸ”§ ä½œæ¥­ç’°å¢ƒ

- å®Ÿè¡Œç’°å¢ƒï¼šWSL2ï¼ˆUbuntuï¼‰
- ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼š`~/projects/litenote/lite-note-infra`
- Terraform ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼š`v1.8.4`ï¼ˆ`terraform -version`ã§ç¢ºèªï¼‰
- AWS CLIï¼š`aws-cli/2.x`ï¼ˆ`aws --version`ã§ç¢ºèªï¼‰
- Gitï¼šç®¡ç†å¯¾è±¡

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆç’°å¢ƒåˆ¥ï¼‰

```
lite-note-infra/
â”œâ”€â”€ environments/
â”‚   â””â”€â”€ dev/
â”‚       â”œâ”€â”€ main.tf
â”‚       â”œâ”€â”€ variables.tf
â”‚       â”œâ”€â”€ outputs.tf
â”‚       â”œâ”€â”€ terraform.tfvars
â”‚       â””â”€â”€ backend.tf
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ vpc/
â”‚   â”œâ”€â”€ s3/
â”‚   â”œâ”€â”€ cloudfront/
â”‚   â”œâ”€â”€ acm/
â”‚   â”œâ”€â”€ route53/
â”‚   â”œâ”€â”€ cognito/
â”‚   â”œâ”€â”€ api_gateway/
â”‚   â”œâ”€â”€ lambda/
â”‚   â”œâ”€â”€ dynamodb/
â”‚   â”œâ”€â”€ waf/
â”‚   â”œâ”€â”€ cloudwatch/
â”‚   â””â”€â”€ sns/
â”œâ”€â”€ docs/
â”œâ”€â”€ logs/
â””â”€â”€ evidence/
```

---

## ğŸ”– ç‹¬è‡ªãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—æ‰‹é †ï¼ˆRoute53ï¼‰

2025/06/29

Terraform ã§ã®ç®¡ç†ã¯æ¨å¥¨ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€**æ‰‹å‹•ã§å–å¾—**ã™ã‚‹ã€‚æœ€åˆã«å®Ÿæ–½ã—ã¦ãŠãã“ã¨ã€‚

1. AWS ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³
2. ã€ŒRoute 53ã€â†’ã€Œãƒ‰ãƒ¡ã‚¤ãƒ³ã®ç™»éŒ²ã€â†’ `example.tech` ãªã©å®‰ä¾¡ãª TLD ã‚’æ¤œç´¢
3. æœ€å®‰ã®ç©ºããƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ100 å††ã€œ1000 å††/å¹´ï¼‰ã‚’é¸æŠ
4. 1 å¹´åˆ†ã‚’é¸ã‚“ã§ç™»éŒ²ï¼ˆè‡ªå‹•æ›´æ–°ã¯ä»»æ„ï¼‰
5. å®Œäº†å¾Œã€Hosted Zone ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹

ğŸ“¸ **è¨¼è·¡**ï¼šå–å¾—å®Œäº†å¾Œã® Hosted Zone ä¸€è¦§ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ `evidence/` ã«ä¿å­˜

---

## âœ… æ§‹ç¯‰æ‰‹é †

### 1. äº‹å‰æº–å‚™

```bash
# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd ~/projects/litenote/lite-note-infra/environments/dev
```

- `terraform.tfvars` ã«ç’°å¢ƒå¤‰æ•°ï¼ˆä¾‹ï¼šVPC CIDRã€ãƒ‰ãƒ¡ã‚¤ãƒ³åã€ç’°å¢ƒåãªã©ï¼‰ã‚’å®šç¾©
- AWS èªè¨¼æƒ…å ±ã®ç¢ºèªï¼š`aws sts get-caller-identity` ã§ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª

### 2. Terraform åˆæœŸåŒ–

```bash
terraform init
```

- ğŸ“¸ **è¨¼è·¡å–å¾—**ï¼šå®Ÿè¡Œãƒ­ã‚°ã‚’ä¿å­˜
  ```bash
  terraform init | tee ../../logs/init-$(date +%Y%m%d).log
  ```

### 3. å®Ÿè¡Œè¨ˆç”»ã®ç¢ºèª

```bash
terraform plan -var-file="terraform.tfvars"
```

- ğŸ“¸ **è¨¼è·¡å–å¾—**ï¼šãƒªã‚½ãƒ¼ã‚¹å¤‰æ›´å†…å®¹ã‚’ãƒ­ã‚°å‡ºåŠ›
  ```bash
  terraform plan -var-file="terraform.tfvars" | tee ../../logs/plan-$(date +%Y%m%d).log
  ```

### 4. é©ç”¨ï¼ˆæœ¬ç•ªåæ˜ ï¼‰

```bash
terraform apply -var-file="terraform.tfvars"
```

- ç¢ºèªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ `yes` ã‚’å…¥åŠ›
- ğŸ“¸ **è¨¼è·¡å–å¾—**ï¼šçµæœã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ or ãƒ­ã‚°ä¿å­˜ï¼ˆALB DNS ãªã©ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼‰

```bash
terraform apply -var-file="terraform.tfvars" | tee ../../logs/apply-$(date +%Y%m%d).log
```

---

## ğŸ“Œ è¨¼è·¡å–å¾—ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

| ã‚¿ã‚¤ãƒŸãƒ³ã‚°                            | å–å¾—æ–¹æ³•                                       | ä¿å­˜å…ˆï¼ˆæ¨å¥¨ï¼‰ |
| ------------------------------------- | ---------------------------------------------- | -------------- |
| `terraform init` / `plan` / `apply`   | `tee`ã§ãƒ­ã‚°ä¿å­˜                                | `logs/`        |
| AWS ãƒªã‚½ãƒ¼ã‚¹æ§‹ç¯‰å¾Œï¼ˆVPC, ALB, S3 ç­‰ï¼‰ | AWS ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ | `evidence/`    |
| ã‚³ã‚¹ãƒˆç¢ºèªï¼ˆä¾‹ï¼šCloudFront ã‚³ã‚¹ãƒˆï¼‰   | AWS è«‹æ±‚ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã‚¹ã‚¯ã‚·ãƒ§               | `evidence/`    |

---

## âœ… ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸå ´åˆã®å¯¾å‡¦

1. `debug-log.md` ã«çŠ¶æ³ã¨è©¦ã—ãŸã“ã¨ã‚’è¨˜éŒ²
2. ã‚¹ã‚¯ã‚·ãƒ§ã‚„ãƒªãƒ³ã‚¯ã‚’æ®‹ã™
3. `terraform destroy` ã§ãƒªã‚»ãƒƒãƒˆå¯èƒ½ï¼ˆæ…é‡ã«ï¼‰

---

## ğŸ’¡ å‚™è€ƒ

- æ§‹æˆå¤‰æ›´ã®éš›ã¯ `plan` çµæœã‚’å¿…ãšãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã“ã¨
- GitHub Actions ãªã©ã® CI/CD ã‚’å°å…¥ã™ã‚‹éš›ã‚‚ `terraform plan/apply` ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’ãƒ­ã‚°åŒ–ã™ã‚‹

---

## ğŸ—‚ å‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«

- `terraform.tfvars.example`ï¼šå¤‰æ•°å®šç¾©ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- `modules/`ï¼šå„ãƒªã‚½ãƒ¼ã‚¹å˜ä½ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤

---

## ğŸ å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] Route53 ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—æ¸ˆï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¿å­˜ï¼‰
- [ ] `terraform init` å®Ÿè¡Œæ¸ˆ
- [ ] `terraform plan` ãƒ­ã‚°å–å¾—æ¸ˆ
- [ ] `terraform apply` ã«ã‚ˆã‚Š AWS ãƒªã‚½ãƒ¼ã‚¹æ§‹ç¯‰æ¸ˆ
- [ ] ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç­‰ã®è¨¼è·¡ãŒ `evidence/` ã«ä¿å­˜æ¸ˆ
- [ ] GitHub ã«ã‚³ãƒŸãƒƒãƒˆï¼Push æ¸ˆ

---

ï¼ˆä½œæˆè€…ï¼š@Toshihiro / æœ€çµ‚æ›´æ–°ï¼š2025-06-29ï¼‰
